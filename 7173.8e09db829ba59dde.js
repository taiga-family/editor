(self.webpackChunkeditor_demo=self.webpackChunkeditor_demo||[]).push([[7173],{7173:(t,e,o)=>{o.r(e),o.d(e,{TableOfContents:()=>P,TableOfContentsPlugin:()=>h,debounce:()=>y,default:()=>P,getHeadlineLevel:()=>v,getHierarchicalIndexes:()=>f,getLastHeadingOnLevel:()=>u,getLinearIndexes:()=>g});var n=o(6426);const s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var i,r=new Uint8Array(16);function d(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)}for(var a=[],l=0;l<256;++l)a.push((l+256).toString(16).slice(1));const c=function(t,e,o){if(s.randomUUID&&!e&&!t)return s.randomUUID();var n=(t=t||{}).random||(t.rng||d)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){o=o||0;for(var i=0;i<16;++i)e[o+i]=n[i];return e}return function(t,e=0){return(a[t[e+0]]+a[t[e+1]]+a[t[e+2]]+a[t[e+3]]+"-"+a[t[e+4]]+a[t[e+5]]+"-"+a[t[e+6]]+a[t[e+7]]+"-"+a[t[e+8]]+a[t[e+9]]+"-"+a[t[e+10]]+a[t[e+11]]+a[t[e+12]]+a[t[e+13]]+a[t[e+14]]+a[t[e+15]]).toLowerCase()}(n)};var p=o(3829);const h=({getId:t,anchorTypes:e=["heading"]})=>new p.k_({key:new p.hs("tableOfContent"),appendTransaction(o,n,s){const i=s.tr;let r=!1;if(o.some(t=>t.docChanged)){const o=[];s.doc.descendants((n,s)=>{const d=n.attrs["data-toc-id"];if(e.includes(n.type.name)&&0!==n.textContent.length){if(null==d||o.includes(d)){let e="";e=t?t(n.textContent):c(),i.setNodeMarkup(s,void 0,{...n.attrs,"data-toc-id":e,id:e}),r=!0}o.push(d)}})}return r?i:null}}),u=(t,e)=>{let o=t.filter(t=>t.level===e).pop();if(0!==e)return o||(o=u(t,e-1)),o},v=(t,e)=>{let o=1;const n=e.at(-1),s=[...e].reverse().find(e=>e.originalLevel<=t.node.attrs.level),i=(null==s?void 0:s.level)||1;return o=t.node.attrs.level>((null==n?void 0:n.originalLevel)||1)?((null==n?void 0:n.level)||1)+1:t.node.attrs.level<((null==n?void 0:n.originalLevel)||1)?i:(null==n?void 0:n.level)||1,o},g=(t,e)=>{const o=e.at(-1);return o?((null==o?void 0:o.itemIndex)||1)+1:1},f=(t,e,o)=>{var n,s;const i=o||t.node.attrs.level||1;let r=1;const d=e.filter(t=>t.level<=i);return r=(null===(n=d.at(-1))||void 0===n?void 0:n.level)===i?((null===(s=d.at(-1))||void 0===s?void 0:s.itemIndex)||1)+1:1,r};function y(t,e){let o=null;return(...n)=>{o&&clearTimeout(o),o=setTimeout(()=>{t(...n)},e)}}const m=(t,e)=>{const{editor:o}=e,n=[],s=[];let i=null;if(o.isDestroyed)return t;if(o.state.doc.descendants((t,o)=>{var s;(null===(s=e.anchorTypes)||void 0===s?void 0:s.includes(t.type.name))&&n.push({node:t,pos:o})}),n.forEach(t=>{const n=o.view.domAtPos(t.pos+1).node;e.storage.scrollPosition>=n.offsetTop&&(i=t.node.attrs["data-toc-id"],s.push(t.node.attrs["data-toc-id"]))}),t=t.map(t=>({...t,isActive:t.id===i,isScrolledOver:s.includes(t.id)})),e.onUpdate){const o=0===e.storage.content.length;e.onUpdate(t,o)}return t},T=t=>{const{editor:e,onUpdate:o}=t;if(e.isDestroyed)return;const n=[];let s=[];const i=[];if(e.state.doc.descendants((e,o)=>{var s;(null===(s=t.anchorTypes)||void 0===s?void 0:s.includes(e.type.name))&&n.push({node:e,pos:o})}),n.forEach((o,r)=>{if(0===o.node.textContent.length)return;const d=e.view.domAtPos(o.pos+1).node,a=t.storage.scrollPosition>=d.offsetTop;i.push(d);const l=o.node.attrs.level,c=n[r-1],p=t.getLevelFn(o,s),h=t.getIndexFn(o,s,p);s=c?[...s,{itemIndex:h,id:o.node.attrs["data-toc-id"],originalLevel:l,level:p,textContent:o.node.textContent,pos:o.pos,editor:e,isActive:!1,isScrolledOver:!1,node:o.node,dom:d}]:[...s,{itemIndex:h,id:o.node.attrs["data-toc-id"],originalLevel:l,level:p,textContent:o.node.textContent,pos:o.pos,editor:e,isActive:!1,isScrolledOver:a,node:o.node,dom:d}]}),s=m(s,t),o){const e=0===t.storage.content.length;o(s,e)}t.storage.anchors=i,t.storage.content=s,e.state.tr.setMeta("toc",s),e.view.dispatch(e.state.tr)},P=n.Extension.create({name:"tableOfContents",addStorage:()=>({content:[],anchors:[],scrollHandler:()=>null,scrollPosition:0}),addGlobalAttributes(){return[{types:this.options.anchorTypes||["headline"],attributes:{id:{default:null,renderHTML:t=>({id:t.id}),parseHTML:t=>t.id||null},"data-toc-id":{default:null,renderHTML:t=>({"data-toc-id":t["data-toc-id"]}),parseHTML:t=>t.dataset.tocId||null}}}]},addOptions:()=>({onUpdate:()=>{},getId:t=>c(),scrollParent:"undefined"!=typeof window?()=>window:void 0,anchorTypes:["heading"]}),addCommands(){return{updateTableOfContents:()=>({dispatch:t})=>{var e;return t&&T({editor:this.editor,storage:this.storage,onUpdate:null===(e=this.options.onUpdate)||void 0===e?void 0:e.bind(this),getIndexFn:this.options.getIndex||g,getLevelFn:this.options.getLevel||v,anchorTypes:this.options.anchorTypes}),!0}}},onTransaction({transaction:t}){var e;t.docChanged&&!t.getMeta("toc")&&T({editor:this.editor,storage:this.storage,onUpdate:null===(e=this.options.onUpdate)||void 0===e?void 0:e.bind(this),getIndexFn:this.options.getIndex||g,getLevelFn:this.options.getLevel||v,anchorTypes:this.options.anchorTypes})},onCreate(){var t;const{tr:e}=this.editor.state,o=[];if(this.options.scrollParent&&"function"!=typeof this.options.scrollParent&&console.warn("[Tiptap Table of Contents Deprecation Notice]: The 'scrollParent' option must now be provided as a callback function that returns the 'scrollParent' element. The ability to pass this option directly will be deprecated in future releases."),this.editor.state.doc.descendants((t,n)=>{var s;const i=t.attrs["data-toc-id"];if((null===(s=this.options.anchorTypes)||void 0===s?void 0:s.includes(t.type.name))&&0!==t.textContent.length){if(null==i||o.includes(i)){let o="";o=this.options.getId?this.options.getId(t.textContent):c(),e.setNodeMarkup(n,void 0,{...t.attrs,"data-toc-id":o,id:o})}o.push(i)}}),this.editor.view.dispatch(e),T({editor:this.editor,storage:this.storage,onUpdate:null===(t=this.options.onUpdate)||void 0===t?void 0:t.bind(this),getIndexFn:this.options.getIndex||g,getLevelFn:this.options.getLevel||v,anchorTypes:this.options.anchorTypes}),this.storage.scrollHandler=()=>{var t;if(!this.options.scrollParent)return;const e="function"==typeof this.options.scrollParent?this.options.scrollParent():this.options.scrollParent,o=e instanceof HTMLElement?e.scrollTop:e.scrollY;this.storage.scrollPosition=o||0;const n=m(this.storage.content,{editor:this.editor,anchorTypes:this.options.anchorTypes,storage:this.storage,onUpdate:null===(t=this.options.onUpdate)||void 0===t?void 0:t.bind(this)});this.storage.content=n},!this.options.scrollParent)return;const n="function"==typeof this.options.scrollParent?this.options.scrollParent():this.options.scrollParent;n&&n.addEventListener("scroll",this.storage.scrollHandler)},onDestroy(){if(!this.options.scrollParent)return;const t="function"==typeof this.options.scrollParent?this.options.scrollParent():this.options.scrollParent;t&&t.removeEventListener("scroll",this.storage.scrollHandler)},addProseMirrorPlugins(){return[h({getId:this.options.getId,anchorTypes:this.options.anchorTypes})]}})}}]);